define("arale/dnd/1.0.0/dnd",["$","arale/base/1.1.1/base","arale/class/1.1.0/class","arale/events/1.1.0/events"],function(a,b,c){function d(a){var b=null;switch(a.type){case"mousedown":if(1===a.which){if(b=m(a.target).data("dnd"),b===!0)b=new l(a.target,m(a.target).data("config"));else{if(b instanceof l!=!0)return;b=m(a.target).data("dnd")}if(b.get("disabled")===!0)return;j(b),t=b,r=a.pageX-t.get("element").offset().left,s=a.pageY-t.get("element").offset().top,o=!0,a.preventDefault()}break;case"mousemove":o===!0&&e(),null!==p&&(f({pageX:a.pageX,pageY:a.pageY}),g(),a.preventDefault());break;case"mouseup":null!==p?(p.css("cursor","default"),p.focus(),p=null,h(),i(),t.trigger("dragend",t.get("element"),q),t=null,q=null):o===!0&&(t.get("proxy").remove(),o=!1,t=null);break;case"keydown":null!==p&&27===a.which&&(p.css("cursor","default"),p.focus(),p=null,i(!0),t.trigger("dragend",t.get("element"),q),t=null,q=null)}}function e(){var a=t.get("element"),b=t.get("proxy"),c=t.get("visible"),d=t.get("dragCursor"),e=t.get("zIndex");c===!1&&a.css("visibility","hidden"),b.css("z-index",e),b.css("visibility","visible"),b.css("cursor",d),b.focus(),u={},o=!1,p=b,t.trigger("dragstart",u,p,q)}function f(a){var b=t.get("containment"),c=t.get("axis"),d=a.pageX-r,e=a.pageY-s;"y"!==c&&(null===b||d>=b.offset().left&&d+p.outerWidth()<=b.offset().left+b.outerWidth()?p.css("left",d):d<=b.offset().left?p.css("left",b.offset().left):p.css("left",b.offset().left+b.outerWidth()-p.outerWidth())),"x"!==c&&(null===b||e>=b.offset().top&&e+p.outerHeight()<=b.offset().top+b.outerHeight()?p.css("top",e):e<=b.offset().top?p.css("top",b.offset().top):p.css("top",b.offset().top+b.outerHeight()-p.outerHeight())),t.trigger("drag",p,q)}function g(){var a=t.get("element"),b=t.get("drop"),c=t.get("dragCursor"),d=t.get("dropCursor"),e=p.offset().left+r,f=p.offset().top+s;null!==b&&(null===q?m.each(b,function(b,c){return 1===c.nodeType&&c!==a.get(0)&&c!==p.get(0)&&k(c,e,f)===!0?(p.css("cursor",d),p.focus(),q=m(c),t.trigger("dragenter",p,q),!1):void 0}):k(q,e,f)===!1?(p.css("cursor",c),p.focus(),t.trigger("dragleave",p,q),q=null):t.trigger("dragover",p,q))}function h(){var a=t.get("element"),b=t.get("proxy"),c=t.get("revert");null!==q&&(k(q,b)===!1&&c===!1&&(b.css("left",q.offset().left+(q.outerWidth()-b.outerWidth())/2),b.css("top",q.offset().top+(q.outerHeight()-b.outerHeight())/2)),t.trigger("drop",u,a,q))}function i(a){var b=t.get("element"),c=t.get("proxy"),d=t.get("drop"),e=t.get("revert"),f=t.get("revertDuration"),g=t.get("visible"),h=c.offset().left-b.offset().left,i=c.offset().top-b.offset().top;e===!0||a===!0||null===q&&null!==d?(b.attr("style",b.data("style")),g===!1&&b.css("visibility","hidden"),c.animate({left:b.offset().left,top:b.offset().top},f,function(){b.css("visibility",""),c.remove()})):("relative"===b.css("position")?(h=(isNaN(parseInt(b.css("left")))?0:parseInt(b.css("left")))+h,i=(isNaN(parseInt(b.css("top")))?0:parseInt(b.css("top")))+i):"absolute"===b.css("position")?(h=c.offset().left,i=c.offset().top):b.css("position","relative"),g===!1?(b.css("left",h),b.css("top",i),b.css("visibility",""),c.remove()):b.animate({left:h,top:i},f,function(){c.remove()}))}function j(a){var b,c=a.get("element"),d=null,e=!1;b=a.get("containment"),0===m(b).length||1!==m(b).get(0).nodeType||m(b).get(0)===c.get(0)||k(m(b).eq(0),c,1)===!1?a.set("containment",null):a.set("containment",m(b).eq(0)),b=a.get("proxy"),0===m(b).length||1!==m(b).get(0).nodeType||m(b).get(0)===c.get(0)||m(b).get(0)===m(a.get("containment")).get(0)?a.set("proxy",c.clone()):a.set("proxy",m(b).eq(0)),d=a.get("proxy"),d.css("position","absolute"),d.css("margin","0"),d.css("left",c.offset().left),d.css("top",c.offset().top),d.css("visibility","hidden"),d.appendTo("body"),b=a.get("drop"),m.each(m(b),function(b,d){return 1===d.nodeType&&d!==c.get(0)&&d!==a.get("proxy").get(0)?(e=!0,!1):void 0}),0===m(b).length||e===!1?a.set("drop",null):a.set("drop",m(b)),b=a.get("axis"),"x"!==b&&"y"!==b&&b!==!1&&a.set("axis",!1),b=a.get("visible"),"boolean"!=typeof b&&a.set("visible",!1),b=a.get("revert"),"boolean"!=typeof b&&a.set("revert",!1),b=a.get("revertDuration"),"number"!=typeof b&&a.set("revertDuration",500),b=a.get("disabled"),"boolean"!=typeof b&&a.set("disabled",!1),b=a.get("dragCursor"),"string"!=typeof b&&a.set("dragCursor","move"),b=a.get("dropCursor"),"string"!=typeof b&&a.set("dropCursor","copy"),b=a.get("zIndex"),"number"!=typeof b&&a.set("zIndex",9999)}function k(a,b,c){var d=c;return"number"!=typeof b?("number"!=typeof d&&(d=0),m(a).offset().left-d<=m(b).offset().left&&m(a).offset().left+m(a).outerWidth()>=m(b).offset().left+m(b).outerWidth()-d&&m(a).offset().top-d<=m(b).offset().top&&m(a).offset().top+m(a).outerHeight()>=m(b).offset().top+m(b).outerHeight()-d):m(a).offset().left<=b&&m(a).offset().left+m(a).outerWidth()>=b&&m(a).offset().top<=c&&m(a).offset().top+m(a).outerHeight()>=c}var l=null,m=a("$"),n=a("arale/base/1.1.1/base"),o=!1,p=null,q=null,r=0,s=0,t=null,u={};l=n.extend({attrs:{element:{value:null,readOnly:!0},containment:null,axis:!1,visible:!1,proxy:null,drop:null,revert:!1,revertDuration:500,disabled:!1,dragCursor:"move",dropCursor:"copy",zIndex:9999},initialize:function(a,b){var c=null;(0===m(a).length||1!==m(a).get(0).nodeType)&&m.error("element error!"),b=m.extend({element:m(a).eq(0)},b),l.superclass.initialize.call(this,b),c=this.get("element"),void 0===c.data("style")&&(void 0===c.attr("style")?c.data("style",""):c.data("style",c.attr("style"))),c.data("dnd",this)},set:function(a,b){t!==this&&l.superclass.set.call(this,a,b,{override:!0})},open:function(){m(document).on("mousedown",d),m(document).on("mousemove",d),m(document).on("mouseup",d),m(document).on("keydown",d)},close:function(){m(document).off("mousedown",d),m(document).off("mousemove",d),m(document).off("mouseup",d),m(document).off("keydown",d)}}),l.prototype.open(),c.exports=l});
